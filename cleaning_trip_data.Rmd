---
title: "Cleaning_trip_data"
author: "Juliette"
date: "10/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Set up my environment

Here I set up my environment by installing packages

```{r installing packages for analysis}
library(tidyverse)
library(dplyr)
```

##  Load and merge files

Here I load the files I will work with

```{r merge 12 excel files}
##  load and merge files
library(data.table)
setwd("C:/Users/julie/OneDrive/Documents/trip/Cyclist")
files <- list.files(pattern = ".csv")
data <- lapply(files, fread, sep= ",")
trip_data <- rbindlist(data)
```

## View data

Here I take a look at the data

```{r look at the data}
head(trip_data)
str(trip_data)
```

## Clean data

Here I clean the data

### Check for duplicates

```{r check for duplicates}
ride_id <- trip_data %>%
  count(ride_id) %>%
  filter(n > 1)
# no duplicates found
```

### Remove N/A columns 

```{r remove N/A values}
trip_data2 <- filter(trip_data, start_station_id != "NA" & end_station_id!="NA")

```

### Remove empty cells

```{r remove empty cells}
trip_data3 <-  filter(trip_data, start_station_name != "" & end_station_name!= "")
```

## Transform data

 Here I transform the data to variables I will work with later to derive insights

### Find time difference in minutes between ended_at and started_at columns

```{r difftime function}

trip_data3$ride_length <- difftime(
  trip_data3$ended_at, 
  trip_data3$started_at,
  units = "mins"
) 
```

### create column for day of the week

Here I create a column to return days of week trips started at

```{r  day of week}
trip_data3$day_of_week <- format(trip_data3$started_at,
                                "%A")
```

### Create column for month

Here I create column for months

```{r months}
trip_data3$month <- format(trip_data3$started_at, "%m")

```

### Create column for years

Here I create column for year

```{ year}
trip_data3$year <- format(trip_data3$started_at, "%y")
str(trip_data3)
```


### change string types for day of week, month and year

```{r change string type}
trip_data3 <- mutate(trip_data3,
      month = as.numeric(month))
```

### change string type for year

```{r year }
trip_data3 <- mutate(trip_data3, year = as.date(year))
```


### view data

```{r view data}
str(trip_data3)
```

## Select variables to work with

Here I select subset of variables for next step in analysis


```{r variables for analysis}
trip_variables <- trip_data3 %>%
  select(ride_id,rideable_type, start_station_name, end_station_name, member_casual, ride_length, day_of_week, year, month)
```

## save raw dataset

Here I save the raw  dataset with 12 combined excel files for future reference

```{r}
fwrite(
  trip_data,
"C:/Users/julie/OneDrive/Documents/Google Data Analytic/R/trip_data.csv",
  col.names = TRUE, 
  row.names = FALSE
)
```

## save cleaned dataset

Here I save the cleaned dataset for reference

```{r cleaned dataset}
fwrite(
  trip_data3, 
  "C:/Users/julie/OneDrive/Documents/Google Data Analytic/R/trip_data3.csv",
  col.names = TRUE, 
  row.names = FALSE
)
```


## save subset of cleaned dataset for analysis

Here I save the subset of cleaned dataset for analysis next

```{r cleaned dataset for analysis}
fwrite(
  trip_variables, 
  "C:/Users/julie/OneDrive/Documents/Google Data Analytic/R/trip_variables.csv",
  col.names = TRUE, 
  row.names = FALSE
)
```

